<!doctype html><html class="scroll-pt-16 scroll-smooth" lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'> <text x='0' y='14'>🧑‍💻</text> </svg>"><link rel=stylesheet href=https://blog.io01.xyz/css/style.css><script type=text/javascript src=https://blog.io01.xyz/js/main.js></script><title>自建NAS方案选型-硬件篇</title></head><body><header class="sticky top-0 z-10 bg-white backdrop-filter backdrop-blur-lg bg-opacity-70 border-b border-gray-200"><nav class="max-w-5xl mx-auto px-4"><div class="flex items-center justify-between h-16"><a href=/ class="text-2xl text-gray-900 font-semibold">IO01 Blog</a><ul class="flex space-x-4 text-gray-900"><li><a href=https://blog.io01.xyz/posts>归档</a></li><li><a href=https://blog.io01.xyz/about>关于</a></li></ul></div></nav></header><div id=content><div class="flex relative justify-center"><article class="w-5/6 md:w-2/3 xl:w-1/2 my-8 px-4 prose max-w-none prose-img:mx-auto"><header class="flex flex-col"><h1 class=text-center>自建NAS方案选型-硬件篇</h1><div class="flex-row mx-auto"><div class=inline-flex><div class="inline-flex items-center not-prose"><svg viewBox="0 0 1 1" class="h-4 mr-1"><use href="#calendar"/></svg>
<span class=text-gray-500>2023-01-13</span></div><div class="inline-flex items-center ml-2 not-prose"><svg viewBox="0 0 1 1" class="h-4 mx-1"><use href="#tags"/></svg>
<a href=https://blog.io01.xyz/tags/homelab/ class="text-gray-500 mr-1">HomeLab</a></div></div></div></header><h2 id=前言>前言</h2><p>之前使用的是多年前很火的威联通 453Bmini，2000 块钱 4 盘位的成品 NAS，性价比很高，开箱即用。虽然很多人认为可用性不如群晖，但是我个人的使用不喜欢依赖某一个品牌的生态，大多是开源组装的，所以对我来说威联通和群晖没什么本质区别。慢慢的用途越来越多，这款 NAS 选用的 J3455 性能低下和硬盘无法休眠实在太吵成了我的困扰，特别在理清了我本身不需要任何成品 NAS 生态的需求后，自己组装一台 NAS 成了唯一选择。</p><h2 id=cpu>CPU</h2><p>首先 CPU 可以分两部分选择：</p><ul><li><strong>零售版</strong>：也就是可以直接在淘宝上买到的单独 CPU，由 Intel 和 AMD 发货。</li><li><strong>OEM 版</strong>：市面上无法直接买到单独的 CPU，由大大小小的 OEM 厂商定制成品板 U。</li></ul><p>首先我选择的是零售版，OEM 版是有不少不错的 CPU 选择，比如 N5105 等，主要原因是主板限制太大，厂商已经榨干了所有扩展性，如果恰好符合自己的需求那确实还不错，如果不巧自己有对扩展性的预留，那可能完全没有任何扩展性了，而且价格其实比零售版板 U 并不便宜，另外一些指令支持不全也是这类 CPU 的一个通病。</p><p>零售版又会遇到两个选择：Intel 和 AMD，选取的一个优先标准的是功耗，所以高端 CPU 就完全不需要考虑了，同时因为之前性能低的阴影希望找个稍微好点的，在 NAS 领域目前的两个强力竞争者是：</p><ul><li><strong>AMD Ryzen 5 5600G</strong>：6 核 12 线程</li><li><strong>Intel Core i3-12100</strong>：4 核 8 线程（13100 不过是 12100 的官方微超版本，性价比更低些）</li></ul><p>客观来说 5600G 的性能比 12100 强，都买散片的前提下板 U 价格也比 12100 低，但是 12100 的核显支持 AV1 解码吸引到了我，虽然现在使用 AV1 编码的视频并不广泛，但是不妨碍战未来的想象！</p><h2 id=机箱>机箱</h2><p><del>NAS 最重要就是机箱</del>，可选内容是：</p><ul><li><strong>主板大小</strong>：一般是选择 Mini-ITX（俗称 ITX，170mm×170mm 以内）和 microATX（又称 mATX，244mm×244mm 以内），mATX 要比 ITX 扩展性好价格更便宜。</li><li><strong>盘位</strong>：自组一般 4、6、8 盘位及以上，另外普通机械硬盘是 3.5 英寸，SATA 接口的 SSD 是 2.5 英寸，所以需要关注 3.5 和 2.5 英寸盘位各有几个。</li><li><strong>电源</strong>：常见的从大到小排序有：ATX 电源（140x150x86mm）、SFX 电源（100x125x63.5mm）、Flex 电源（国内叫小 1U 电源，150x40.5x81.5 mm）。前两种面对零售发布，有比较多的厂家，小 1U 电源购买渠道大多咸鱼，另外噪音要高一些。</li><li><strong>硬盘排布和热插拔</strong>：其实一般也不会总插拔硬盘，但是如果不是专门设计过的机箱，每次折腾硬盘都得拆机箱确实也是个比较头疼的事情。</li><li><strong>散热</strong>：主要考虑整体散热性能和是否需要特殊 CPU 散热器。</li><li><strong>体积</strong>：其实体积是定完上述大小后大概的体积也就定了，这个选项也决定了为何不选普通机箱，普通机箱又便宜盘位又多，但是太大了。</li><li><strong>价格和颜值</strong>：last but not least。</li></ul><p>主板考虑到考虑到扩展性选择了 mATX，盘位 6 盘及以上，电源心理排位 SFX>ATX>Flex，价格在 700 以内。综合的选择是御夫座，虽然体积确实比较大，但是比它小的大部分都是 ITX 主板或者 1U 电源，要么就更贵一些，要么更丑一些。NAS 机箱是个小众领域，可选项不多且偏贵，而且各花入各眼，各取所需即可。</p><h2 id=主板>主板</h2><p>定下 CPU 之后主板就很容易选择了：B660 和 H610，主板关注几个 SATA 口、几个 PCI-E 槽位和长度、几个 M.2 接口，H610 普遍比较丐，扩展性很低，所以选 B660m。铭瑄 B660m 确实什么都非常好，扩展性拉满，但是价格我买的时候 700 多还是高了些。转念一想 12100 并不需要特别强的供电，NAS 也不需要 BIOS 和灯效，干脆投奔华南这种丐板。
最后选择的是华南 B660-D4：</p><ul><li>4 个 SATA</li><li>2 个 M.2</li><li>1 个 PCI-E×16、1 个 PCI-E×4</li></ul><p>总的来说虽然供电比较丐，但是 400 块钱价位里扩展性还算可以了，正好之前的 NAS 的 4 块硬盘可以直接插上，后面入手新硬盘也可以直接用 PCIE 或者 M.2 扩展。需要注意它的 SYS_FAN 一共两个，有一个是 3 针的，所以需要买条 1 分 4 风扇线插到唯一的 4 针接口上。</p><p><em>更新：华南出了加量不加价的 B660M-PLUS，背刺好心痛：</em></p><ul><li><em>4 个 SATA</em></li><li><em>2 个 M.2、1 个 M.2 WiFi</em></li><li><em>1 个 PCI-E×16、1 个 PCI-E×4、1 个 PCI-E×1</em></li></ul><h2 id=电源>电源</h2><p>电源的参数主要是：</p><ul><li><strong>功率</strong>：根据自己需求给出一定冗余度即可，另外需要关注电源的额定功率和峰值功率，电源负载不了太久峰值输出功率。</li><li><strong>转换率</strong>：有个 80Plus 认证，指的是 50%负载时电源的转换效率，一般是价格合适情况下越高越好，不要选无牌白牌。</li><li><strong>模组化</strong>：非模组、半模组和全模组，区别可以只插自己需要的供电线，很多 NAS 机箱布局狭窄，尽量少插入无用的线，而且可能还需要定制特定长度和材质的线，所以全模组更适合 NAS，但是价格会贵不少。</li><li><strong>方案与用料</strong>：<ul><li>LLC 半桥/全桥 > 双管正激 > 单管正激</li><li>DC to DC > 双路磁放大 > 单路磁放大</li><li>日系用料 > 台系用料 > 国产</li><li>单路 12V 输出 > 双路 12V 输出</li></ul></li></ul><p>用家用组装机的思路来看，理论上来说 NAS 一般是核显或者亮机卡，CPU 也是追求低功耗，电源不需要太大的功率，150W 的电源都绰绰有余，但是很容易忽视 NAS 的硬盘（特别是机械硬盘）数量要超过大部分家庭娱乐电脑。机械硬盘有个问题是启动时瞬时功耗很高，以常见的希捷酷狼 8T 为例，启动电压 12V，启动电流 2A，功率达到 24W，如果 5 个机械硬盘启动功率就能达到 120W 了。</p><p>有些高端主板和阵列卡支持硬盘顺序加电，对电源的要求会小很多。成品 NAS 给配的电源也不高，但是有趣的是不是所有 NAS 都能做到顺序加电，所以有满盘企业级机械盘因为 NAS 电源导致的数据悲剧案例。</p><p>12V 供电能力和纹波是对硬盘启动影响最大的因素，但是不幸的是这方面厂商数据不太透明，只能在网上查找相关测评资料，如果不是非常在乎也可以不用关心。</p><h3 id=跌坑更新>跌坑更新</h3><p>最初觉得电源要求不高，买的是金河田 G4，400w 全模组铜牌电源，看起来功率达标，200 块钱的全模组要什么自行车。但是实际使用发现硬盘总是报错，怀疑电源有问题，咸鱼找了个鑫谷 GP600G 黑金版，同样 200 块钱，问题解决，同时风扇声音也小了不少。</p><h2 id=sata-扩展卡>SATA 扩展卡</h2><p>主板自带的 4 个 SATA 口已经算是中规中矩，但是我选择的是 6 个 HDD+2 个 SSD 盘位的机箱，所以肯定还是得需要买个 SATA 扩展卡，至于是扩展卡还是 HBA 卡还是阵列卡刷 IT 模式，又是一个选择题，其实也很简单：咸鱼上正好碰上什么量大便宜就选什么。</p><p>听闻另外两种发热稍大，反正价格相差不大，我的需求也很低，所以选择了扩展卡，一般来说扩展卡需要关注：</p><ul><li>驱动，这是决定能不能用的最大因素，如果是 Windows，基本上可以无脑淘宝随便找个，甚至很多魔改的都能驱动，Windows 的兼容性真的无敌，但是 Linux 很多芯片是没有开箱即用的驱动的，所以咸鱼购买毋必问清芯片方案。</li><li>扩展个数，我的需求是 4-6 口，但是需要注意有些扩展卡是两个芯片组起来的，比如 ASM1061+JMB575（1+5），Linux 默认只能识别一个芯片，除非足够便宜只用其中一个芯片（比如 ASM1166+JMB575 的卡只使用 ASM1166），或者有能力折腾驱动。</li><li>占用的主板位置，一般是 PCI-E×1 和 PCI-E×4，也有用 M.2 口的，根据自己主板自行选择即可。</li></ul><p>最后我意中的方案是 ASM1166，最高 6 口扩展，Linux 可以免驱，但是在 600 系主板下无法使用，得在非 600 系主板上更新一下固件或者找商家帮忙搞定，可惜我没有非 600 系主板，给更新的商家卖得太贵。最后退而求其次选择了 JMB585，5 口扩展，胜在咸鱼上比较便宜。</p><h2 id=总价>总价</h2><p>把大件定下来其他小件就随便在淘宝上选择了，稍微超过了 2000 元的预算，如果大件都换成咸鱼货，应该能差不多到 2000 元左右，奈何我急用。</p><table><thead><tr><th>配件</th><th style=text-align:right>价格</th></tr></thead><tbody><tr><td>御夫座机箱 + 风扇 + 散热器 + 6 口 SATA 线（套餐）</td><td style=text-align:right>788</td></tr><tr><td>i3-12100 散片</td><td style=text-align:right>659</td></tr><tr><td>华南 B660-D4 主板</td><td style=text-align:right>420</td></tr><tr><td>酷兽夜枭 2666MHz 8GB ×2 内存</td><td style=text-align:right>224</td></tr><tr><td>鑫谷 GP600G 黑金版电源(咸鱼)</td><td style=text-align:right>200</td></tr><tr><td>乐扩 5 口 SATA 扩展卡(咸鱼)</td><td style=text-align:right>49</td></tr><tr><td>1 分 4 风扇线</td><td style=text-align:right>12</td></tr><tr><td>总价</td><td style=text-align:right>2352</td></tr></tbody></table><h2 id=功耗>功耗</h2><p>全盘插满也就是 2SSD+6HDD，PT 随缘保种个 10 来 TB（含多站重复保种），整机有读写时功耗在 75-80W/h 左右，没有读写的时候在 68-70W/h 左右。</p><p>其实硬盘多了之后 CPU 那点功率已经不值一提了，随便一个硬盘 8-10W 的功率，外加我的机械硬盘是跟随我 10 来年的 7200 转企业盘，当年技术不如现在，功率也更高一些。PT 保种导致了几乎所有 HDD 都没法休眠，所以无论怎么折腾也不可能把功率降一半，干脆放弃治疗了，等后面慢慢把硬盘替换成 5400 转，然后把 PT 限制在一到两个盘上再来折腾功耗吧。</p><div class="flex flex-row justify-between"><div class=not-prose><a class="inline-flex items-center group text-gray-400 hover:text-sky-400" href=https://blog.io01.xyz/posts/6op1/><svg viewBox="0 0 1 1" class="fill-gray-400 group-hover:fill-sky-400 h-4 mx-1"><use href="#angle-left"/></svg>
自建NAS方案选型-基建篇</a></div><div class=not-prose><a class="inline-flex items-center group text-gray-400 hover:text-sky-400" href=https://blog.io01.xyz/posts/9qg5/>子线程更新 UI 全解<svg viewBox="0 0 1 1" class="fill-gray-400 group-hover:fill-sky-400 h-4 mx-1"><use href="#angle-right"/></svg></a></div></div></article><aside class="fixed md:left-5/6 xl:left-3/4 hidden md:block top-16 w-1/6 max-h-screen p-4 shadow-md"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#cpu>CPU</a></li><li><a href=#机箱>机箱</a></li><li><a href=#主板>主板</a></li><li><a href=#电源>电源</a><ul><li><a href=#跌坑更新>跌坑更新</a></li></ul></li><li><a href=#sata-扩展卡>SATA 扩展卡</a></li><li><a href=#总价>总价</a></li><li><a href=#功耗>功耗</a></li></ul></nav></aside></div></div><footer><div class="flex justify-center mt-6 mb-2 text-gray-500"><span>&copy;2024
<span class=ml-2><a class=hover:text-sky-400 href=https://blog.io01.xyz>IO01</a>
</span></span><span class=mx-2>|</span>
<span>Powered by
<a class=hover:text-sky-400 href=https://gohugo.io>Hugo</a>
</span><span class=mx-1>&</span>
<span><a class=hover:text-sky-400 href=#>FullMoon</a></span></div></footer></body></html>