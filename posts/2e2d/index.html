<!doctype html><html class="scroll-pt-16 scroll-smooth" lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'> <text x='0' y='14'>ğŸ§‘â€ğŸ’»</text> </svg>"><link rel=stylesheet href=https://blog.io01.xyz/css/style.css><script type=text/javascript src=https://blog.io01.xyz/js/main.js></script><title>ä»æºç è§£æä¸€ä¸ª SparseArray çº¿ç¨‹ä¸å®‰å…¨çš„å´©æºƒ</title></head><body><header class="sticky top-0 z-10 bg-white backdrop-filter backdrop-blur-lg bg-opacity-70 border-b border-gray-200"><nav class="max-w-5xl mx-auto px-4"><div class="flex items-center justify-between h-16"><a href=/ class="text-2xl text-gray-900 font-semibold">IO01 Blog</a><ul class="flex space-x-4 text-gray-900"><li><a href=https://blog.io01.xyz/posts>å½’æ¡£</a></li><li><a href=https://blog.io01.xyz/about>å…³äº</a></li></ul></div></nav></header><div id=content><div class="flex relative justify-center"><article class="w-5/6 md:w-2/3 xl:w-1/2 my-8 px-4 prose max-w-none prose-img:mx-auto"><header class="flex flex-col"><h1 class=text-center>ä»æºç è§£æä¸€ä¸ª SparseArray çº¿ç¨‹ä¸å®‰å…¨çš„å´©æºƒ</h1><div class="flex-row mx-auto"><div class=inline-flex><div class="inline-flex items-center not-prose"><svg viewBox="0 0 1 1" class="h-4 mr-1"><use href="#calendar"/></svg><span class=text-gray-500>2023-04-12</span></div><div class="inline-flex items-center ml-2 not-prose"><svg viewBox="0 0 1 1" class="h-4 mx-1"><use href="#tags"/></svg><a href=https://blog.io01.xyz/tags/android/ class="text-gray-500 mr-1">Android</a>
<a href=https://blog.io01.xyz/tags/%E6%BA%90%E7%A0%81/ class="text-gray-500 mr-1">æºç </a></div></div></div></header><h2 id=å‰è¨€>å‰è¨€</h2><p>å·¥ä½œä¸­é‡åˆ°ä¸€ä¸ªå´©æºƒï¼Œå°†æ— å…³é€»è¾‘å»æ‰ï¼Œæœ€åçš„å´©æºƒéƒ¨åˆ†æ˜¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>sparseArray<span style=color:#ff79c6>.</span><span style=color:#50fa7b>get</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>1</span><span style=color:#ff79c6>)</span> <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>null</span><span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  Log<span style=color:#ff79c6>.</span><span style=color:#50fa7b>i</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;SparseArray&#34;</span><span style=color:#ff79c6>,</span> sparseArray<span style=color:#ff79c6>.</span><span style=color:#50fa7b>get</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>1</span><span style=color:#ff79c6>).</span><span style=color:#50fa7b>toString</span><span style=color:#ff79c6>());</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><p>æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ç©ºæŒ‡é’ˆï¼š<code>java.lang.NullPointerException</code>ï¼Œå…¶å®æ ¹æ®ç»éªŒä¹ŸçŸ¥é“æ˜¯çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯æ’æŸ¥çš„è¿‡ç¨‹ä¸­å´è¶Šæ¥è¶Šè§‰å¾—æˆ‘ä»¬çš„åº”ç”¨åœºæ™¯ä¸­ä¸åº”è¯¥å‡ºç° null çš„å­˜åœ¨ã€‚</p><h2 id=æ’æŸ¥>æ’æŸ¥</h2><h3 id=åˆ é™¤>åˆ é™¤</h3><p>è¿™ä¸ªé—®é¢˜ç¬¬ä¸€ååº”æ˜¯æœ‰ä¸€ä¸ªçº¿ç¨‹ä» sparseArray ä¸­åˆ é™¤äº†å¯¹è±¡ï¼Œç„¶åå¯¼è‡´ç¬¬äºŒæ¬¡è·å–æˆäº† <code>null</code>ï¼Œä½†æ˜¯ç»§ç»­æ’æŸ¥ä»£ç å‘ç°å¹¶æ²¡æœ‰ä»»ä½•åœ°æ–¹è°ƒç”¨è¿‡åˆ é™¤ï¼ˆå¦å¤–æ ¹æ®åé¢ç¿»é˜…æºç å¾—çŸ¥ <code>SparseArray#delete()</code> å¹¶ä¸ä¼šç«‹åˆ»åˆ é™¤ä»£ç ï¼Œè€Œæ˜¯å…ˆæ ‡è®°ä¸º <code>DELETED</code>ï¼‰ã€‚</p><h3 id=æ‰©å®¹>æ‰©å®¹</h3><p>ä¸‹ä¸€ä¸ªæ€è·¯å°±æ˜¯ç±»ä¼¼ HashMap æ‰©å®¹æ—¶æ¬è¿æ•°æ®é€ æˆçš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä½†æ˜¯ç»æ£€æŸ¥ï¼Œæ‰€æœ‰ <code>sparseArray.put()</code> çš„ key æ˜¯å›ºå®šçš„ä¸‰ä¸ªå€¼ï¼š0ã€1ã€2ï¼Œç”šè‡³éƒ½æ˜¯ä¸»çº¿ç¨‹ put çš„ï¼Œè€Œ SparseArray åˆå§‹åŒ–çš„æºç å¯ä»¥çŸ¥é“é»˜è®¤æ„é€ å‡½æ•°æ˜¯åˆå§‹åŒ–äº†ä¸¤ä¸ªé•¿åº¦ä¸º 10 çš„æ•°ç»„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#50fa7b>SparseArray</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#ff79c6>this</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>10</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#50fa7b>SparseArray</span><span style=color:#ff79c6>(</span><span style=color:#8be9fd>int</span> initialCapacity<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>initialCapacity <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span><span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        mKeys <span style=color:#ff79c6>=</span> EmptyArray<span style=color:#ff79c6>.</span><span style=color:#50fa7b>INT</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        mValues <span style=color:#ff79c6>=</span> EmptyArray<span style=color:#ff79c6>.</span><span style=color:#50fa7b>OBJECT</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#ff79c6>}</span> <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        mValues <span style=color:#ff79c6>=</span> ArrayUtils<span style=color:#ff79c6>.</span><span style=color:#50fa7b>newUnpaddedObjectArray</span><span style=color:#ff79c6>(</span>initialCapacity<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        mKeys <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>int</span><span style=color:#ff79c6>[</span>mValues<span style=color:#ff79c6>.</span><span style=color:#50fa7b>length</span><span style=color:#ff79c6>];</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    mSize <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><p><em>æœ‰ä¸ªæœ‰è¶£çš„ç‚¹ï¼šå…¶ä¸­ <code>ArrayUtils.newUnpaddedObjectArray(initialCapacity)</code> ä¼šè°ƒç”¨ <code>VMRuntime.getRuntime().newUnpaddedArray(Object.class, minLen)</code> è¿”å›ä¸€ä¸ªè‡³å°‘ä¸º minLen é•¿åº¦çš„æ•°ç»„ï¼Œå› ä¸º
<a title href=https://en.wikipedia.org/wiki/Data_structure_alignment>æ•°æ®å¯¹é½</a> å¯èƒ½ä¼šåˆ†é…å¤§äºç”³è¯·çš„ç©ºé—´ä½¿ CPU è¯»å†™æ›´åŠ é«˜æ•ˆï¼Œå³ä¼šæœ‰ä¸€äº› padding ç©ºé—´ï¼Œä¸ºäº†ä¸æµªè´¹è¿™ä¸ªç©ºé—´ï¼Œç›´æ¥è¿”å›ä¸ªæ›´å¤§çš„ arrayã€‚</em></p><h3 id=é‡æ’>é‡æ’</h3><p>æ—¢ç„¶æ— è®ºå¦‚ä½•ï¼Œéƒ½ä¸ä¼šæœ‰æ‰©å®¹çš„äº§ç”Ÿï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆæƒ…å†µä¸‹ä¼šé€ æˆåœ¨æŸä¸€ç¬é—´ä¼šè·å–åˆ° null å‘¢ï¼Ÿè¿™é‡Œéœ€è¦ä»‹ç»ä¸€ä¸‹ SparseArray çš„åŸºæœ¬åŸç†ï¼š</p><ul><li>å†…éƒ¨ç»“æ„æ˜¯ä¸¤ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªå‚¨å­˜ key çš„ int æ•°ç»„ï¼Œä¸€ä¸ªå‚¨å­˜ value çš„ Object æ•°ç»„ã€‚</li><li><code>get()</code> ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰€ä»¥ key æ•°ç»„æ˜¯æœ‰åºçš„ã€‚</li></ul><p>é‚£ä¹ˆé—®é¢˜å°±èƒ½çŒœåˆ°ï¼šä¼šä¸ä¼šæ˜¯æ·»åŠ æ•°æ®çš„æ—¶å€™å› ä¸ºæ„å»ºæœ‰åºæ•°ç»„è€Œé‡æ’æ—¶å¯¼è‡´äº†æ•°æ®çš„æ¬è¿ï¼Œæˆ‘ä»¬å¯ä»¥ä»æºç ä¸­çœ‹ä¸€ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1</span><span><span style=color:#6272a4>// android.util.SparseArray
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>put</span><span style=color:#ff79c6>(</span><span style=color:#8be9fd>int</span> key<span style=color:#ff79c6>,</span> E value<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3</span><span>    <span style=color:#6272a4>// é¦–å…ˆäºŒåˆ†æŸ¥æ‰¾ key æ•°ç»„ä¸­è¦æ’å…¥çš„ key çš„ä½ç½®ï¼Œå¦‚æœå­˜åœ¨ key ç›´æ¥è¿”å› key çš„ä¸‹æ ‡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›æœŸæœ›æ’å…¥çš„ä½ç½®çš„å–åï¼ˆå‚è§ä¸‹é¢çš„æºç ï¼Œä¸è¯¦è§£é‡Šï¼‰
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> ContainerHelpers<span style=color:#ff79c6>.</span><span style=color:#50fa7b>binarySearch</span><span style=color:#ff79c6>(</span>mKeys<span style=color:#ff79c6>,</span> mSize<span style=color:#ff79c6>,</span> key<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6</span><span>    <span style=color:#6272a4>// å¦‚æœå­˜åœ¨ keyï¼Œç›´æ¥æ›´æ–°å¯¹åº”çš„ value å³å¯
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>i <span style=color:#ff79c6>&gt;=</span> <span style=color:#bd93f9>0</span><span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8</span><span>        mValues<span style=color:#ff79c6>[</span>i<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> value<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9</span><span>    <span style=color:#ff79c6>}</span> <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10</span><span>        <span style=color:#6272a4>// å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ‹¿åˆ°æ’å…¥æœŸæœ›çš„ä½ç½®
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11</span><span><span style=color:#6272a4></span>        i <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>~</span>i<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13</span><span>        <span style=color:#6272a4>// mSize æ˜¯å½“å‰å®é™…å·²æ’å…¥çš„æ•°æ®é‡ï¼Œåœ¨æœªè°ƒç”¨ gc() ä¹‹å‰åŒ…æ‹¬å·²ç»æ ‡è®°ä¸º DELETED çš„æ•°æ®
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// DELETED æ˜¯åœ¨ delete() åå¹¶ä¸ä¼šç«‹åˆ»åˆ é™¤ä»£ç ï¼Œè€Œæ˜¯å…ˆæ ‡è®°ä¸º DELETED
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// å¦‚æœæœŸæœ›æ’å…¥çš„ä½ç½®å°äº mSizeï¼Œå¹¶ä¸”æ­¤å¤„æ˜¯å·²ç»è¢«æ ‡è®°åˆ é™¤çš„æ•°æ®ï¼Œåˆ™ç›´æ¥æ›´æ–° kv ä¸¤ä¸ªæ•°ç»„
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>i <span style=color:#ff79c6>&lt;</span> mSize <span style=color:#ff79c6>&amp;&amp;</span> mValues<span style=color:#ff79c6>[</span>i<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>==</span> DELETED<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17</span><span>            mKeys<span style=color:#ff79c6>[</span>i<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> key<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18</span><span>            mValues<span style=color:#ff79c6>[</span>i<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> value<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19</span><span>            <span style=color:#ff79c6>return</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20</span><span>        <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22</span><span>        <span style=color:#6272a4>// å¦‚æœéœ€è¦åƒåœ¾å›æ”¶å¹¶ä¸”ç°åœ¨å·²ç»æ’å…¥çš„æ•°é‡å¤§äºç­‰äº key æ•°ç»„çš„é•¿åº¦ï¼Œåˆ™åƒåœ¾å›æ”¶
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>mGarbage <span style=color:#ff79c6>&amp;&amp;</span> mSize <span style=color:#ff79c6>&gt;=</span> mKeys<span style=color:#ff79c6>.</span><span style=color:#50fa7b>length</span><span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24</span><span>            <span style=color:#6272a4>// å°†è¢«æ ‡è®°ä¸º DELETED çš„ä½ç½®åé¢çš„æ•°æ®å‘å‰æ¬è¿æ¥åƒåœ¾å›æ”¶ï¼ˆå‚è§ä¸‹é¢çš„æºç ï¼Œä¸è¯¦è§£é‡Šï¼‰
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25</span><span><span style=color:#6272a4></span>            gc<span style=color:#ff79c6>();</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27</span><span>            <span style=color:#6272a4>// å›æ”¶åé‡æ–°æŸ¥æ‰¾æœŸæœ›æ’å…¥çš„ä½ç½®
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28</span><span><span style=color:#6272a4></span>            i <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>~</span>ContainerHelpers<span style=color:#ff79c6>.</span><span style=color:#50fa7b>binarySearch</span><span style=color:#ff79c6>(</span>mKeys<span style=color:#ff79c6>,</span> mSize<span style=color:#ff79c6>,</span> key<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29</span><span>        <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31</span><span>        <span style=color:#6272a4>// é€šè¿‡ System.arraycopy åˆ›å»ºä¸€ä¸ªæ’å…¥ i ä½ç½®åçš„é€’å¢æ–°æ•°ç»„ï¼ˆå‚è§ä¸‹é¢çš„æºç ï¼Œä¸è¯¦è§£é‡Šï¼‰
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32</span><span><span style=color:#6272a4></span>        mKeys <span style=color:#ff79c6>=</span> GrowingArrayUtils<span style=color:#ff79c6>.</span><span style=color:#50fa7b>insert</span><span style=color:#ff79c6>(</span>mKeys<span style=color:#ff79c6>,</span> mSize<span style=color:#ff79c6>,</span> i<span style=color:#ff79c6>,</span> key<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33</span><span>        <span style=color:#6272a4>// é€šè¿‡ System.arraycopy åˆ›å»ºä¸€ä¸ªæ’å…¥ i ä½ç½®åçš„é€’å¢æ–°æ•°ç»„
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34</span><span><span style=color:#6272a4></span>        mValues <span style=color:#ff79c6>=</span> GrowingArrayUtils<span style=color:#ff79c6>.</span><span style=color:#50fa7b>insert</span><span style=color:#ff79c6>(</span>mValues<span style=color:#ff79c6>,</span> mSize<span style=color:#ff79c6>,</span> i<span style=color:#ff79c6>,</span> value<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35</span><span>        <span style=color:#6272a4>// mSize è‡ªå¢ 1
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36</span><span><span style=color:#6272a4></span>        mSize<span style=color:#ff79c6>++;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37</span><span>    <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38</span><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40</span><span><span style=color:#6272a4>// com.android.internal.util.GrowingArrayUtils
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span> T<span style=color:#ff79c6>[]</span> <span style=color:#50fa7b>insert</span><span style=color:#ff79c6>(</span>T<span style=color:#ff79c6>[]</span> array<span style=color:#ff79c6>,</span> <span style=color:#8be9fd>int</span> currentSize<span style=color:#ff79c6>,</span> <span style=color:#8be9fd>int</span> index<span style=color:#ff79c6>,</span> T element<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42</span><span>    <span style=color:#ff79c6>assert</span> currentSize <span style=color:#ff79c6>&lt;=</span> array<span style=color:#ff79c6>.</span><span style=color:#50fa7b>length</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43</span><span>    <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>currentSize <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;=</span> array<span style=color:#ff79c6>.</span><span style=color:#50fa7b>length</span><span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44</span><span>        System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>arraycopy</span><span style=color:#ff79c6>(</span>array<span style=color:#ff79c6>,</span> index<span style=color:#ff79c6>,</span> array<span style=color:#ff79c6>,</span> index <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span><span style=color:#ff79c6>,</span> currentSize <span style=color:#ff79c6>-</span> index<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45</span><span>        array<span style=color:#ff79c6>[</span>index<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> element<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46</span><span>        <span style=color:#ff79c6>return</span> array<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47</span><span>    <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48</span><span>    @SuppressWarnings<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;unchecked&#34;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49</span><span>    T<span style=color:#ff79c6>[]</span> newArray <span style=color:#ff79c6>=</span> ArrayUtils<span style=color:#ff79c6>.</span><span style=color:#50fa7b>newUnpaddedArray</span><span style=color:#ff79c6>((</span>Class<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;)</span>array<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getClass</span><span style=color:#ff79c6>().</span><span style=color:#50fa7b>getComponentType</span><span style=color:#ff79c6>(),</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50</span><span>            growSize<span style=color:#ff79c6>(</span>currentSize<span style=color:#ff79c6>));</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51</span><span>    System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>arraycopy</span><span style=color:#ff79c6>(</span>array<span style=color:#ff79c6>,</span> <span style=color:#bd93f9>0</span><span style=color:#ff79c6>,</span> newArray<span style=color:#ff79c6>,</span> <span style=color:#bd93f9>0</span><span style=color:#ff79c6>,</span> index<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52</span><span>    newArray<span style=color:#ff79c6>[</span>index<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> element<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53</span><span>    System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>arraycopy</span><span style=color:#ff79c6>(</span>array<span style=color:#ff79c6>,</span> index<span style=color:#ff79c6>,</span> newArray<span style=color:#ff79c6>,</span> index <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span><span style=color:#ff79c6>,</span> array<span style=color:#ff79c6>.</span><span style=color:#50fa7b>length</span> <span style=color:#ff79c6>-</span> index<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54</span><span>    <span style=color:#ff79c6>return</span> newArray<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55</span><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57</span><span><span style=color:#6272a4>// android.util.ContainerHelpers
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd>int</span> <span style=color:#50fa7b>binarySearch</span><span style=color:#ff79c6>(</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>[]</span> array<span style=color:#ff79c6>,</span> <span style=color:#8be9fd>int</span> size<span style=color:#ff79c6>,</span> <span style=color:#8be9fd>int</span> value<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59</span><span>    <span style=color:#8be9fd>int</span> lo <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60</span><span>    <span style=color:#8be9fd>int</span> hi <span style=color:#ff79c6>=</span> size <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62</span><span>    <span style=color:#ff79c6>while</span> <span style=color:#ff79c6>(</span>lo <span style=color:#ff79c6>&lt;=</span> hi<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63</span><span>        <span style=color:#8be9fd;font-style:italic>final</span> <span style=color:#8be9fd>int</span> mid <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>(</span>lo <span style=color:#ff79c6>+</span> hi<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#bd93f9>1</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64</span><span>        <span style=color:#8be9fd;font-style:italic>final</span> <span style=color:#8be9fd>int</span> midVal <span style=color:#ff79c6>=</span> array<span style=color:#ff79c6>[</span>mid<span style=color:#ff79c6>];</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66</span><span>        <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>midVal <span style=color:#ff79c6>&lt;</span> value<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67</span><span>            lo <span style=color:#ff79c6>=</span> mid <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68</span><span>        <span style=color:#ff79c6>}</span> <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>midVal <span style=color:#ff79c6>&gt;</span> value<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69</span><span>            hi <span style=color:#ff79c6>=</span> mid <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70</span><span>        <span style=color:#ff79c6>}</span> <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71</span><span>            <span style=color:#ff79c6>return</span> mid<span style=color:#ff79c6>;</span>  <span style=color:#6272a4>// value found
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73</span><span>    <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74</span><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>~</span>lo<span style=color:#ff79c6>;</span>  <span style=color:#6272a4>// value not present
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77</span><span><span style=color:#6272a4>// android.util.SparseArray
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>gc</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79</span><span>    <span style=color:#8be9fd>int</span> n <span style=color:#ff79c6>=</span> mSize<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80</span><span>    <span style=color:#8be9fd>int</span> o <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81</span><span>    <span style=color:#8be9fd>int</span><span style=color:#ff79c6>[]</span> keys <span style=color:#ff79c6>=</span> mKeys<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82</span><span>    Object<span style=color:#ff79c6>[]</span> values <span style=color:#ff79c6>=</span> mValues<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84</span><span>    <span style=color:#ff79c6>for</span> <span style=color:#ff79c6>(</span><span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span><span style=color:#ff79c6>;</span> i <span style=color:#ff79c6>&lt;</span> n<span style=color:#ff79c6>;</span> i<span style=color:#ff79c6>++)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85</span><span>        Object val <span style=color:#ff79c6>=</span> values<span style=color:#ff79c6>[</span>i<span style=color:#ff79c6>];</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87</span><span>        <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>val <span style=color:#ff79c6>!=</span> DELETED<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88</span><span>            <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>i <span style=color:#ff79c6>!=</span> o<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89</span><span>                keys<span style=color:#ff79c6>[</span>o<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> keys<span style=color:#ff79c6>[</span>i<span style=color:#ff79c6>];</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90</span><span>                values<span style=color:#ff79c6>[</span>o<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> val<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91</span><span>                values<span style=color:#ff79c6>[</span>i<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92</span><span>            <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94</span><span>            o<span style=color:#ff79c6>++;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95</span><span>        <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96</span><span>    <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98</span><span>    mGarbage <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>false</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99</span><span>    mSize <span style=color:#ff79c6>=</span> o<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100</span><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><p>æºç ä¸­å½±å“åˆ° value æ•°ç»„çš„æ“ä½œæœ‰ gc å’Œæœ€ååœ¨æ•°ç»„ä¸­æ’å…¥æ•°æ®ã€‚æˆ‘ä»¬çš„åœºæ™¯ä¸æ¶‰åŠåˆ é™¤ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿ gcã€‚è€Œä¸”ä»”ç»†æƒ³æƒ³è¿™ä¸¤æ­¥ï¼Œgc æ˜¯æŠŠåé¢çš„æ•°æ®æ¬è¿åˆ°è¢«æ ‡è®°ä¸ºåˆ é™¤çš„ä½ç½®ï¼›æ’å…¥å…ƒç´ ç›´æ¥ç”Ÿæˆæ–°çš„æ•°ç»„ï¼Œéƒ½ä¸ä¼šå¯¼è‡´æŸä¸€æ—¶åˆ» value æ•°ç»„ä¸­æ›¾ç»çš„å…ƒç´ ä¸º nullã€‚</p><h2 id=åŸå› >åŸå› </h2><p>åé¢æƒ³æƒ³å…¶å®æ€è·¯ç‹­éš˜äº†ï¼Œä¸€ç›´è€ƒè™‘çš„æ˜¯ value æ•°ç»„ä¸­æŸä¸ªä½ç½®çš„å…ƒç´ åœ¨æŸä¸€æ—¶åˆ»å˜ä¸º nullï¼Œä½†æ˜¯ä¸Šé¢çš„åˆ†ææ¥çœ‹å¯èƒ½ä¼šå› ä¸ºçº¿ç¨‹ä¸å®‰å…¨é€ æˆä¸¤æ¬¡ <code>get()</code> å¾—åˆ°çš„å€¼ä¸åŒï¼Œä½†æ˜¯ä¸ä¼šå‡ºç°å…¶ä¸­ä¸€æ¬¡ä¸º nullã€‚</p><p>åˆ†æ <code>put()</code> æ–¹æ³•æœ€åä¸‰è¡Œï¼Œå¯ä»¥å‘ç° <code>mKeys</code>ã€<code>mValues</code> å’Œ <code>mSize</code> éƒ½å¯èƒ½å› ä¸ºå¤šçº¿ç¨‹æ‰§è¡Œ <code>get()</code> å¯¼è‡´å‡ºç°é—®é¢˜ï¼Œåˆ†åˆ«å¯¹åº”ä¸‰ç§å¯èƒ½ï¼š</p><ol><li><code>mKeys</code> æœªæ”¹å˜å‰å…¶ä»–çº¿ç¨‹ <code>get()</code>ã€‚</li><li><code>mValues</code> æœªæ”¹å˜å‰å…¶ä»–çº¿ç¨‹ <code>get()</code>ã€‚</li><li><code>mSize</code> æœªæ”¹å˜å‰å…¶ä»–çº¿ç¨‹ <code>get()</code>ã€‚</li></ol><p>çœ‹ä¸€ä¸‹ <code>get()</code> çš„æºç ï¼Œéå¸¸ç®€å•ï¼ŒäºŒåˆ†æŸ¥æ‰¾ indexï¼Œä» <code>mValues</code> æ•°ç»„ä¸­å–å€¼ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#8be9fd;font-style:italic>public</span> E <span style=color:#50fa7b>get</span><span style=color:#ff79c6>(</span><span style=color:#8be9fd>int</span> key<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#ff79c6>return</span> get<span style=color:#ff79c6>(</span>key<span style=color:#ff79c6>,</span> <span style=color:#ff79c6>null</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#8be9fd;font-style:italic>public</span> E <span style=color:#50fa7b>get</span><span style=color:#ff79c6>(</span><span style=color:#8be9fd>int</span> key<span style=color:#ff79c6>,</span> E valueIfKeyNotFound<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> ContainerHelpers<span style=color:#ff79c6>.</span><span style=color:#50fa7b>binarySearch</span><span style=color:#ff79c6>(</span>mKeys<span style=color:#ff79c6>,</span> mSize<span style=color:#ff79c6>,</span> key<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>||</span> mValues<span style=color:#ff79c6>[</span>i<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>==</span> DELETED<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        <span style=color:#ff79c6>return</span> valueIfKeyNotFound<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#ff79c6>}</span> <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>(</span>E<span style=color:#ff79c6>)</span> mValues<span style=color:#ff79c6>[</span>i<span style=color:#ff79c6>];</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><p>ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå…ˆå‡è®¾æˆ‘ä»¬çš„ key å–å€¼ä¸º 0ã€1ã€2ï¼Œvalue å¯¹åº”å–å€¼ä¸º"é›¶"ã€&ldquo;ä¸€&rdquo;ã€&ldquo;äºŒ&rdquo;ï¼ŒåŒæ—¶å› ä¸ºæ•°ç»„æ’å…¥æ˜¯é€’å¢çš„ï¼Œæ¶‰åŠåˆ°äº†æ•°ç»„é‡æ’ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡è®¾ä¸¤ç§åœºæ™¯æ¥ï¼š</p><ol><li>æ–°æ’å…¥çš„ key æ¯”ä¹‹å‰æ‰€æœ‰çš„ key å¤§ï¼šå‡è®¾åŸæœ‰ [0,1] æ’å…¥ 2ã€‚</li><li>æ–°æ’å…¥çš„ key æ¯”ä¹‹å‰æœ€å¤§çš„ key å°ï¼šå‡è®¾åŸæœ‰ [0,2] æ’å…¥ 1ã€‚</li></ol><p>é‚£ä¹ˆåˆ†æä¸Šè¿°ä¸‰ç§å¯èƒ½ä¸ºï¼š</p><ol><li><p><code>mKeys</code> æœªæ”¹å˜å‰ç›¸å½“äºè¿˜æ²¡æœ‰æ‰§è¡Œ <code>put()</code>ã€‚</p><ol><li>åŸæœ‰ [0,1] æ’å…¥ 2ï¼š<code>get(1)</code> ä¼šæ­£å¸¸è¿”å›"ä¸€"ï¼›<code>get(2)</code> ä¼šå› ä¸º <code>binarySearch()</code> ç­‰äº -3ï¼Œè¿”å›é»˜è®¤çš„ nullã€‚</li><li>åŸæœ‰ [0,2] æ’å…¥ 1ï¼š<code>get(1)</code> ä¼šå› ä¸º <code>binarySearch()</code> ç­‰äº -2ï¼Œè¿”å›é»˜è®¤çš„ nullï¼›<code>get(2)</code> ä¼šæ­£å¸¸è¿”å›"äºŒ"ã€‚</li><li>ç»“è®ºï¼šä¸å¯èƒ½å‡ºç°ç¬¬ä¸€æ¬¡ get æœ‰å€¼ä½†ç¬¬äºŒæ¬¡ä¸º null çš„æƒ…å†µã€‚</li></ol></li><li><p><code>mValues</code> æœªæ”¹å˜å‰ <code>mKeys</code> å·²ç»æ’å…¥äº†æ–° put çš„å€¼ã€‚</p><ol><li>åŸæœ‰ [0,1] æ’å…¥ 2ï¼š<code>get(1)</code> ä¼šæ­£å¸¸è¿”å›"ä¸€"ï¼›<code>get(2)</code> ä¼šå› ä¸º <code>binarySearch()</code> ç­‰äº -3ï¼Œè¿”å›é»˜è®¤çš„ nullã€‚</li><li>åŸæœ‰ [0,2] æ’å…¥ 1ï¼š<code>get(1)</code> è¿”å›â€œäºŒâ€ï¼›<code>get(2)</code> ä¼šå› ä¸º <code>mSize</code> æœªæ”¹å˜å¯¼è‡´ <code>binarySearch()</code> ç­‰äº -3ï¼Œè¿”å›é»˜è®¤çš„ nullã€‚</li><li>ç»“è®ºï¼šç¬¬äºŒç§åœºæ™¯å‡ºç°äº†æ²¡æ’å…¥å‰ <code>get(2)</code> æœ‰å€¼ï¼Œæ’å…¥ä¹‹å <code>get(2)</code> ä¸º null çš„æƒ…å†µã€‚å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯æ­¤æ—¶ <code>get(1)</code> çš„è¿”å›å€¼ä¹Ÿæ˜¯é”™è¯¯çš„ã€‚</li></ol></li><li><p><code>mSize</code> æœªæ”¹å˜å‰ <code>mKeys</code>å’Œ <code>mValues</code> éƒ½æ’å…¥äº†æ–° put çš„å€¼ã€‚</p><ol><li>åŸæœ‰ [0,1] æ’å…¥ 2ï¼š<code>get(1)</code>ä¼šæ­£å¸¸è¿”å›"ä¸€"ï¼›<code>get(2)</code> ä¼šå› ä¸º <code>binarySearch()</code> ç­‰äº -3ï¼Œè¿”å›é»˜è®¤çš„ nullã€‚</li><li>åŸæœ‰ [0,2] æ’å…¥ 1ï¼š<code>get(1)</code>ä¼šæ­£å¸¸è¿”å›"ä¸€"ï¼›<code>get(2)</code> ä¼šå› ä¸º <code>binarySearch()</code> ç­‰äº -3ï¼Œè¿”å›é»˜è®¤çš„ nullã€‚</li><li>ç»“è®ºï¼šç¬¬äºŒç§åœºæ™¯å‡ºç°äº†æ²¡æ’å…¥å‰ <code>get(2)</code> æœ‰å€¼ï¼Œæ’å…¥ä¹‹å <code>get(2)</code> ä¸º null çš„æƒ…å†µã€‚</li></ol></li></ol><p>æ‰€ä»¥åœ¨å‘ç”Ÿé‡æ’çš„åœºæ™¯ä¸­ï¼Œæœ‰å¯èƒ½å› ä¸ºå¤šçº¿ç¨‹åŒæ—¶è¯»å†™å‡ºç°ä¹‹å‰é‡åˆ°çš„é—®é¢˜ã€‚</p><h2 id=å¤ç°>å¤ç°</h2><p>æ—¢ç„¶çŸ¥é“äº†åŸå› ï¼Œå¤ç°ä»£ç è¿˜æ˜¯å¾ˆç®€å•çš„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>AtomicBoolean noNull <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> AtomicBoolean<span style=color:#ff79c6>(</span><span style=color:#ff79c6>true</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>while</span> <span style=color:#ff79c6>(</span>noNull<span style=color:#ff79c6>.</span><span style=color:#50fa7b>get</span><span style=color:#ff79c6>())</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    SparseArray<span style=color:#ff79c6>&lt;</span>Object<span style=color:#ff79c6>&gt;</span> sparseArray <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> SparseArray<span style=color:#ff79c6>&lt;&gt;();</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    sparseArray<span style=color:#ff79c6>.</span><span style=color:#50fa7b>put</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>,</span> <span style=color:#ff79c6>new</span> Object<span style=color:#ff79c6>());</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#ff79c6>new</span> Thread<span style=color:#ff79c6>(()</span> <span style=color:#ff79c6>-&gt;</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>sparseArray<span style=color:#ff79c6>.</span><span style=color:#50fa7b>get</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>)</span> <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>null</span><span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>            Log<span style=color:#ff79c6>.</span><span style=color:#50fa7b>d</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;SparseArray&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;get is null&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>            noNull<span style=color:#ff79c6>.</span><span style=color:#50fa7b>set</span><span style=color:#ff79c6>(</span><span style=color:#ff79c6>false</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#ff79c6>}).</span><span style=color:#50fa7b>start</span><span style=color:#ff79c6>();</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    sparseArray<span style=color:#ff79c6>.</span><span style=color:#50fa7b>put</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>0</span><span style=color:#ff79c6>,</span> <span style=color:#ff79c6>new</span> Object<span style=color:#ff79c6>());</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    sparseArray<span style=color:#ff79c6>.</span><span style=color:#50fa7b>put</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>1</span><span style=color:#ff79c6>,</span> <span style=color:#ff79c6>new</span> Object<span style=color:#ff79c6>());</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><div class="flex flex-row justify-between"><div class=not-prose></div><div class=not-prose><a class="inline-flex items-center group text-gray-400 hover:text-sky-400" href=https://blog.io01.xyz/posts/6op1/>è‡ªå»ºNASæ–¹æ¡ˆé€‰å‹-åŸºå»ºç¯‡<svg viewBox="0 0 1 1" class="fill-gray-400 group-hover:fill-sky-400 h-4 mx-1"><use href="#angle-right"/></svg></a></div></div></article><aside class="fixed md:left-5/6 xl:left-3/4 hidden md:block top-16 w-1/6 max-h-screen p-4 shadow-md"><nav id=TableOfContents><ul><li><a href=#å‰è¨€>å‰è¨€</a></li><li><a href=#æ’æŸ¥>æ’æŸ¥</a><ul><li><a href=#åˆ é™¤>åˆ é™¤</a></li><li><a href=#æ‰©å®¹>æ‰©å®¹</a></li><li><a href=#é‡æ’>é‡æ’</a></li></ul></li><li><a href=#åŸå› >åŸå› </a></li><li><a href=#å¤ç°>å¤ç°</a></li></ul></nav></aside></div></div><footer><div class="flex justify-center mt-6 mb-2 text-gray-500"><span>&copy;2023
<span class=ml-2><a class=hover:text-sky-400 href=https://blog.io01.xyz>IO01</a></span></span>
<span class=mx-2>|</span>
<span>Powered by
<a class=hover:text-sky-400 href=https://gohugo.io>Hugo</a></span>
<span class=mx-1>&</span>
<span><a class=hover:text-sky-400 href=#>FullMoon</a></span></div></footer></body></html>