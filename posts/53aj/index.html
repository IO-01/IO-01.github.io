<!doctype html><html class="scroll-pt-16 scroll-smooth" lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=stylesheet href=https://blog.io01.xyz/css/style.css><script type=text/javascript src=https://blog.io01.xyz/js/main.js></script><title>时间格式化的趣事：YYYY 示年</title></head><body><header class="sticky top-0 z-10 bg-white backdrop-filter backdrop-blur-lg bg-opacity-70 border-b border-gray-200"><nav class="max-w-5xl mx-auto px-4"><div class="flex items-center justify-between h-16"><a href=/ class="text-2xl text-gray-900 font-semibold">IO01 Blog</a><ul class="flex space-x-4 text-gray-900"><li><a href=https://blog.io01.xyz/posts>归档</a></li><li><a href=https://blog.io01.xyz/about>关于</a></li></ul></div></nav></header><div id=content><div class="flex relative justify-center"><article class="w-5/6 md:w-2/3 xl:w-1/2 my-8 px-4 prose max-w-none prose-img:mx-auto"><header class="flex flex-col"><h1 class=text-center>时间格式化的趣事：YYYY 示年</h1><div class="flex-row mx-auto"><div class=inline-flex><div class="inline-flex items-center not-prose"><svg viewBox="0 0 1 1" class="h-4 mr-1"><use href="#calendar"/></svg><span class=text-gray-500>2020-02-27</span></div><div class="inline-flex items-center ml-2 not-prose"><svg viewBox="0 0 1 1" class="h-4 mx-1"><use href="#series"/></svg><a href=https://blog.io01.xyz/series/themes-guide/ class=text-gray-500>Themes Guide</a></div><div class="inline-flex items-center ml-2 not-prose"><svg viewBox="0 0 1 1" class="h-4 mx-1"><use href="#tags"/></svg><a href=https://blog.io01.xyz/tags/java/ class="text-gray-500 mr-1">Java</a></div></div></div></header><h2 id=引言>引言</h2><p>2019 年 12 月 29 到 31 日在格式化时间时出现了一个有趣的小 bug：比如 2019 年 12 月 31 日时间戳有可能会被格式化成：2020-12-31。</p><h2 id=复现>复现</h2><p>这里给出复现和对比的代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>Long timeStamp <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1577750400000L</span><span style=color:#ff79c6>;</span><span style=color:#6272a4>//2019-12-31 08:00:00 的时间戳
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span>SimpleDateFormat sdf1 <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> SimpleDateFormat<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;yyyy-MM-dd&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>SimpleDateFormat sdf2 <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> SimpleDateFormat<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;YYYY-MM-dd&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>println</span><span style=color:#ff79c6>(</span>sdf1<span style=color:#ff79c6>.</span><span style=color:#50fa7b>format</span><span style=color:#ff79c6>(</span>timeStamp<span style=color:#ff79c6>));</span><span style=color:#6272a4>//System.out: 2019-12-31
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>println</span><span style=color:#ff79c6>(</span>sdf2<span style=color:#ff79c6>.</span><span style=color:#50fa7b>format</span><span style=color:#ff79c6>(</span>timeStamp<span style=color:#ff79c6>));</span><span style=color:#6272a4>//System.out: 2020-12-31
</span></span></span></code></pre></div><p>可以看到当年份格式化时，使用 <code>YYYY</code> 会被格式化成 2020，而 <code>yyyy</code> 是我们想要的 2019。</p><h2 id=原因>原因</h2><p>显而易见，这个 bug 出现的原因是：<code>y</code> 和 <code>Y</code> 的语义不同。根据 JDK 文档规定：<code>y</code> 表示年份（Year），<code>Y</code> 表示周所属的年份（Week year）。</p><p>根据 ISO 8601 定义：包含当年第一个周四的那一周是第一周（等效语义：1 月 4 日所在的周是第一周）。JDK 默认的周起始日是周日，所以 2019-12-29 到 2020-01-04 是 2020 年的第一周。那么使用 <code>YYYY</code> 格式化出来的数据 2019-12-29 到 2019-12-31 都是 2020。</p><div class="flex flex-row justify-between"><div class=not-prose><a class="inline-flex items-center group text-gray-400 hover:text-sky-400" href=https://blog.io01.xyz/posts/2aa2/><svg viewBox="0 0 1 1" class="fill-gray-400 group-hover:fill-sky-400 h-4 mx-1"><use href="#angle-left"/></svg>遵循 Google 应用指南的 Retrofit + Coroutine 封装</a></div><div class=not-prose><a class="inline-flex items-center group text-gray-400 hover:text-sky-400" href=https://blog.io01.xyz/posts/33dn/>MD5 计算前导 0 丢失问题<svg viewBox="0 0 1 1" class="fill-gray-400 group-hover:fill-sky-400 h-4 mx-1"><use href="#angle-right"/></svg></a></div></div></article></div></div><footer><div class="flex justify-center mt-6 mb-2 text-gray-500"><span>&copy;2023
<span class=ml-2><a class=hover:text-sky-400 href=https://blog.io01.xyz>IO01</a></span></span>
<span class=mx-2>|</span>
<span>Powered by
<a class=hover:text-sky-400 href=https://gohugo.io>Hugo</a></span>
<span class=mx-1>&</span>
<span><a class=hover:text-sky-400 href=#>FullMoon</a></span></div></footer></body></html>